# Day 20

## 오늘 목표
- 전투 중 타겟팅/이동 흐름을 안정화해서
  - 타겟이 계속 바뀌며 흔들리는 현상 줄이기
  - 일정 거리에서 멈추고 공격을 안 하는 현상 정리하기

---

## 오늘 한 작업 요약

### 1) 타겟 고정(Target Lock) + 재탐색(Retarget) 시스템 도입
- `Unit`에 현재 타겟을 저장하는 필드 추가
  - `currentTarget`
- 타겟 재탐색 최소 간격 추가
  - `retargetInterval`
  - `nextRetargetTime`

**의도**
- 매 프레임 FindNearestEnemy를 계속 돌리면 타겟이 계속 바뀌어 이동이 불안정해짐
- 타겟이 없거나 죽었을 때만, 일정 간격으로 다시 찾도록 개선

---

### 2) 전투 분기(공격/이동) 단순화
- 거리 기준으로 분기를 단순화
  - `dist <= attackRange` → 공격
  - 그 외 → 이동

**의도**
- attackRange 근처에서 “멈추고 공격 안 하는 구간”이 생기는 문제를 줄이기 위해
- 중간 구간(stopBuffer 등)을 최소화하고 흐름을 명확히 함

---

### 3) 공격 상태 플래그(isAttacking) 도입
- `Unit`에 공격 상태값을 추가
  - `isAttacking`, `IsAttacking`
- 공격 중에는 이동을 막도록 처리
  - `MoveTowards()`에서 공격 중이면 return

**의도**
- 공격/이동 상태를 분리해 동작을 예측 가능하게 유지

---

## 정리(결과)
- 유닛이 매 프레임 타겟을 바꾸지 않고 “한 타겟을 물고” 움직이도록 개선
- 전투 중 이동/공격 흐름이 더 단순하고 안정적으로 변경됨
- (추가로) 불필요한 함수/변수는 정리 대상(미사용 코드 제거 가능)

---

## 메모(삭제 후보)
- `stopBuffer`, `ApplySeparationOnly()`는 현재 전투 루프에서 사용하지 않으면 제거 가능
- `SpawnUnitAt()` 및 scaling 변수들은 자동 배치 기능을 쓰지 않으면 제거 가능
